---
phase: 22
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - tests/test_cli_modes.py
  - .planning/phases/22-mode-verification/22-01-SUMMARY.md
autonomous: true
must_haves:
  truths:
    - "CLI tests confirm translate/translate-batch echo `Translation mode:` and `Mode:` lines per requested mode."
    - "Automated checks guard against regressions in defaults (smart) and allowed modes (smart/preserve/linear/instant)."
  artifacts:
    - path: tests/test_cli_modes.py
      provides: pytest suite verifying CLI logging for each transition mode
      min_lines: 60
  key_links:
    - from: tests/test_cli_modes.py
      to: src/translate_profile/cli.py
      via: "runs translate_profile.translate() with mode arg and asserts echoed strings"
---

<objective>
Add automated CLI tests that exercise the new `--mode` option for both single-profile and batch commands, ensuring output includes the expected mode annotations and that defaults remain smart. Output: a pytest module plus summary file describing the commands verified.
</objective>

<execution_context>
@/home/juan/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/juan/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Write CLI mode tests for translate</name>
  <files>tests/test_cli_modes.py</files>
  <action>Implement pytest functions that invoke `.workspace-venv/bin/translate-profile translate ... --mode <mode>` (using subprocess or Typer runner) for each allowed mode plus the default. Capture stdout and assert that the lines `Translation mode: <mode>` and `Mode: <mode>` appear. Ensure smart default is also tested.</action>
  <verify>Run `pytest tests/test_cli_modes.py::test_translate_modes` and confirm all cases (smart/preserve/linear/instant/default) pass.</verify>
  <done>translate-mode CLI runs are covered by automated tests that check the echo lines and exit codes, so regressions in the mode flag are caught.</done>
</task>

<task type="auto">
  <name>Task 2: Cover translate-batch mode logging</name>
  <files>tests/test_cli_modes.py</files>
  <action>Add tests that run `.workspace-venv/bin/translate-profile translate-batch ... --mode <mode>` to ensure the batch summary includes `Mode: <mode>` for linear, smart, and a mode override. Validate summary text and exit status; keep translator invocation intact by trusting existing translation logic.</action>
  <verify>Run `pytest tests/test_cli_modes.py::test_batch_mode_logging` and check for the expected strings and exit code (0 or failure due to validation as long as logging happens).</verify>
  <done>Batch command mode logging is verified in pytest, covering default behavior and overrides.</done>
</task>

</tasks>

<verification>
- Ensures `tests/test_cli_modes.py` exists, tests both commands with each mode/default, and passes locally via `pytest`.
</verification>

<success_criteria>
Running pytest on the new module passes all translate/translate-batch mode tests, producing the required SUMMARY.md evidence of execution.
</success_criteria>

<output>
After completion, create `.planning/phases/22-mode-verification/22-01-SUMMARY.md`.
</output>
