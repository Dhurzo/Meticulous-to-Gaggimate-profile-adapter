---
phase: 12-module-extraction-tests
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: []
autonomous: true
user_setup: []

must_haves:
  truths:
    - "convert_exit_triggers function is importable from exit_mode module"
    - "Module exports are properly defined in __init__.py"
    - "All unit tests pass (EXIT-01 through EXIT-07, VAL-01 through VAL-03)"
  artifacts:
    - path: "src/translate_profile/exit_mode.py"
      provides: "convert_exit_triggers, detect_conflicting_triggers, ExitTarget"
      exports: ["convert_exit_triggers", "detect_conflicting_triggers", "ExitTarget"]
    - path: "src/translate_profile/__init__.py"
      provides: "Module-level exports for translate_profile package"
      contains: "exit_mode exports"
    - path: "tests/test_exit_translation.py"
      provides: "Unit tests for EXIT-01 through EXIT-07"
      tests: ["EXIT-01", "EXIT-02", "EXIT-03", "EXIT-04", "EXIT-05", "EXIT-06", "EXIT-07"]
    - path: "tests/test_exit_validation.py"
      provides: "Unit tests for VAL-01, VAL-02, VAL-03"
      tests: ["VAL-01", "VAL-02", "VAL-03"]
  key_links:
    - from: "src/translate_profile/__init__.py"
      to: "src/translate_profile/exit_mode.py"
      via: "module import"
      pattern: "from .exit_mode import"
    - from: "tests/test_exit_translation.py"
      to: "src/translate_profile/exit_mode.py"
      via: "function call"
      pattern: "convert_exit_triggers"
    - from: "tests/test_exit_validation.py"
      to: "src/translate_profile/exit_mode.py"
      via: "function call"
      pattern: "convert_exit_triggers"
---

<objective>
Verify module extraction is complete and all unit tests pass for exit mode translation and validation.

Purpose: Ensure the exit_mode module (created in Phases 10-11) is properly exported, importable, and fully tested with comprehensive coverage of all EXIT and VAL requirements.

Output: Verified module exports, all tests passing, MOD-01/MOD-02/MOD-03 requirements satisfied.
</objective>

<execution_context>
@/home/juan/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/juan/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md

# Prior work context
src/translate_profile/exit_mode.py: Contains convert_exit_triggers function (already exists)
src/translate_profile/translator.py: Already imports from exit_mode module
tests/test_exit_translation.py: Tests EXIT-01 through EXIT-07 (already exists)
tests/test_exit_validation.py: Tests VAL-01 through VAL-03 (already exists)
</context>

<tasks>

<task type="auto">
  <name>Verify exit_mode module exports</name>
  <files>src/translate_profile/__init__.py, src/translate_profile/exit_mode.py</files>
  <action>
    Check that __init__.py properly exports exit_mode functions. If exit_mode functions are not exported at package level, add the exports to __init__.py:

    ```python
    from .exit_mode import convert_exit_triggers, detect_conflicting_triggers
    from .exit_mode import ExitTarget
    ```

    Verify exit_mode.py has proper __all__ definition: `["convert_exit_triggers", "detect_conflicting_triggers", "ExitTarget"]`
  </action>
  <verify>`python -c "from src.translate_profile.exit_mode import convert_exit_triggers, detect_conflicting_triggers, ExitTarget; print('All exports OK')"`</verify>
  <done>exit_mode module exports are accessible via import statements</done>
</task>

<task type="auto">
  <name>Run exit translation tests</name>
  <files>tests/test_exit_translation.py</files>
  <action>
    Run all exit translation tests to verify EXIT-01 through EXIT-07 requirements are satisfied:

    ```bash
    cd /home/juan/Repos/Meticulous-to-Gaggimate-profile-adapter && python -m pytest tests/test_exit_translation.py -v
    ```

    Expected: All 7 EXIT tests pass (EXIT-01: Weight→Volumetric, EXIT-02: Time→Time, EXIT-03: Pressure→Pressure, EXIT-04: Flow→Flow, EXIT-05: Operator mapping, EXIT-06: Relative time conversion, EXIT-07: Single-pass conversion)
  </action>
  <verify>`python -m pytest tests/test_exit_translation.py -v --tb=short` returns all passing</verify>
  <done>All EXIT-01 through EXIT-07 translation tests pass</done>
</task>

<task type="auto">
  <name>Run exit validation tests</name>
  <files>tests/test_exit_validation.py</files>
  <action>
    Run all exit validation tests to verify VAL-01, VAL-02, VAL-03 requirements are satisfied:

    ```bash
    cd /home/juan/Repos/Meticulous-to-Gaggimate-profile-adapter && python -m pytest tests/test_exit_validation.py -v
    ```

    Expected: All 3 VAL tests pass (VAL-01: Conflicting triggers detection, VAL-02: Duplicate trigger reporting, VAL-03: Categorized warnings)
  </action>
  <verify>`python -m pytest tests/test_exit_validation.py -v --tb=short` returns all passing</verify>
  <done>All VAL-01, VAL-02, VAL-03 validation tests pass</done>
</task>

<task type="auto">
  <name>Verify module is importable from batch_processor</name>
  <files>src/translate_profile/batch_processor.py</files>
  <action>
    Verify exit_mode can be imported from batch_processor.py. Check if batch_processor.py has access to exit_mode functions:

    ```bash
    cd /home/juan/Repos/Meticulous-to-Gaggimate-profile-adapter && python -c "from src.translate_profile.batch_processor import *; print('batch_processor can access module')"
    ```

    If this fails, add the necessary import to batch_processor.py:

    ```python
    from .exit_mode import convert_exit_triggers, detect_conflicting_triggers
    from .exit_mode import ExitTarget
    ```

    This satisfies MOD-02 requirement.
  </action>
  <verify>`python -c "from src.translate_profile import exit_mode; print('Module importable:', hasattr(exit_mode, 'convert_exit_triggers'))"`</verify>
  <done>exit_mode module is importable from batch_processor.py context</done>
</task>

</tasks>

<verification>
After task completion, verify MOD requirements:

1. **MOD-01:** Check `convert_exit_triggers` exists:
   ```bash
   python -c "from src.translate_profile.exit_mode import convert_exit_triggers; print('MOD-01: ✓ convert_exit_triggers exists')"
   ```

2. **MOD-02:** Check module importable:
   ```bash
   python -c "from src.translate_profile.exit_mode import *; print('MOD-02: ✓ Module importable')"
   ```

3. **MOD-03:** Check test coverage:
   ```bash
   python -m pytest tests/test_exit_translation.py tests/test_exit_validation.py -v --tb=short 2>&1 | grep -E "PASSED|FAILED|ERROR"
   ```
   Expected: All tests show PASSED

4. **Final verification:**
   ```bash
   python -m pytest tests/test_exit_translation.py tests/test_exit_validation.py -v 2>&1 | tail -5
   ```
   Expected: "X passed" with no failures
</verification>

<success_criteria>
- [ ] MOD-01: `convert_exit_triggers` function exists in exit_mode.py (verify import works)
- [ ] MOD-02: Module is importable from batch_processor.py context
- [ ] MOD-03: All unit tests pass (EXIT-01 through EXIT-07, VAL-01 through VAL-03)
- [ ] All 13 v2.0 requirements (EXIT-01-07 + VAL-01-03 + MOD-01-03) are satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/12-module-extraction-tests/12-01-SUMMARY.md`
</output>
